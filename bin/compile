#!/usr/bin/env ruby
require 'pp'
require 'fileutils'

BUILD_DIR, CACHE_DIR, ENV_DIR = ARGV

def runtime_environment
  entries = Dir.entries(ENV_DIR) - ['.', '..']
  entries.map { |name| [name, File.read(File.join(ENV_DIR, name))] }.to_h
end

puts '# BUILD_DIR', BUILD_DIR
puts '# CACHE_DIR', CACHE_DIR
puts '# ENV_DIR', ENV_DIR

puts '# Build environment'
pp ENV
puts '# Runtime environment'
pp runtime_environment

puts '# /app/README.md'
puts File.read('/app/README.md')

if runtime_environment['DEBUG_BUILDPACK_CONTENTS']
  puts '# BUILD_DIR contents'
  pp Dir.entries BUILD_DIR
  puts '# / contents'
  pp Dir.entries '/'
  puts '# /app contents'
  pp Dir.entries '/app'
  puts '# /bin contents'
  pp Dir.entries '/bin'
  puts '# /usr/bin contents'
  pp Dir.entries '/usr/bin'
end

exit 0
